# 11.2 KMP算法
- 思想：避免文本串中指针的回退，利用已知信息使模式串尽可能右移
![](Picture/Pasted%20image%2020241203164708.png)
- 代码实现：i永不后退
- ![](Picture/Pasted%20image%2020241203164619.png)
	- 如果匹配，则i与j均右移
	- 若失配，则i不动，j = next\[j\]，模式串右移
## next\[\]
![](Picture/Pasted%20image%2020241203164402.png)
- next\[0\] = -1，当T\[i\] != P\[0\]，说明文本串指针应当向右移，代码进入else条件，j = -1，下一次循环中进入if条件，i++、j++
- next\[j\] = t，t为P\[0, j)中，真前缀和真后缀匹配的最大长度
### 递推计算next\[j + 1\]
- 已知next\[0, j\]，当P\[j\] = P\[next\[j\]\]，next\[j + 1\] = next\[j\] + 1
	- 若P\[j\] != P\[next\[j\]\]，则比较P\[j\]与P\[next\[next\[j\]\]\]、P\[next\[next\[next\[j\]\]\]\]...
		- 直到相等，此时next\[j + 1\] = next\[...next\[j\]...\] + 1
## 改进next\[\]
- next\[\]仅考虑了真前后缀匹配提供的信息，未考虑当前字符匹配失败提供的信息
	- 对于上述模式串，若在P\[4\] == 'C'处匹配失败，则会跳转到P\[next\[4\]\] == P\[0\] == 'C'处再次比较，此时仍会失败
	- 可以减少失败后的模式串移动次数
- t为P\[0, j)中，真前缀和真后缀匹配的最大长度，且P\[j\] != P\[t\]时，next\[j\] = t
	- 若P\[j\] = P\[t\]，则next\[j\] = next\[t\]
![](Picture/Pasted%20image%2020241204132421.png)
### 例题
已知模式串为'ABCCOAEOTABCP'，在使用改进版next\[\]表的KMP算法时，模式串单次右移的最大长度为<u>   11   </u>.
![](Picture/Pasted%20image%2020241204135124.png)
右移长度就是j - next\[j\]，故最大为11 - 0 = 11.
